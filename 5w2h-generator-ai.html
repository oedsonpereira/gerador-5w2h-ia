<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Plano de A√ß√£o 5W2H com IA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 10px;
        }

        .info-box {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .info-box ul {
            margin-left: 20px;
            color: #555;
            line-height: 1.6;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .warning-box h3 {
            color: #f57c00;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .warning-box p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .warning-box a {
            color: #667eea;
            font-weight: 600;
            text-decoration: none;
        }

        .warning-box a:hover {
            text-decoration: underline;
        }

        .api-section {
            background: #e8eaf6;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .api-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .api-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .api-input-group input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: monospace;
        }

        .api-input-group button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .api-input-group button:hover {
            background: #5568d3;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #dc3545;
        }

        .status-dot.connected {
            background: #10b981;
        }

        .input-section {
            margin-bottom: 30px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .example-problems {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .example-problems h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .example-item {
            background: white;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid #667eea;
        }

        .example-item:hover {
            background: #e8eaf6;
            transform: translateX(5px);
        }

        .example-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }

        .example-item span {
            font-size: 0.9em;
            color: #666;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        button {
            flex: 1;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .download-btn {
            background: #10b981;
            color: white;
            display: none;
        }

        .download-btn:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .loading {
            text-align: center;
            padding: 30px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #667eea;
            font-weight: 600;
            font-size: 1.1em;
        }

        .result-section {
            display: none;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 3px solid #667eea;
        }

        .result-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .result-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .result-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            color: #333;
        }

        .result-table tr:last-child td {
            border-bottom: none;
        }

        .result-table tr:nth-child(even) {
            background: #f8f9ff;
        }

        .dimension {
            font-weight: 600;
            color: #667eea;
            min-width: 150px;
            font-size: 1.05em;
        }

        .error-message {
            background: #fee;
            border-left: 4px solid #f44;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
            color: #c33;
        }

        .success-message {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
            color: #155724;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .button-group {
                flex-direction: column;
            }

            .api-input-group {
                flex-direction: column;
            }

            .result-table {
                font-size: 0.9em;
            }

            .result-table th,
            .result-table td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Gerador de Plano de A√ß√£o 5W2H com IA</h1>
            <p>Intelig√™ncia Artificial analisa seu problema e cria um plano de a√ß√£o completo</p>
            <span class="badge">‚ú® Powered by Claude AI</span>
        </div>

        <div class="warning-box">
            <h3>‚ö†Ô∏è Configura√ß√£o Necess√°ria para Compartilhar</h3>
            <p>
                <strong>Para desenvolvedores/usu√°rios finais:</strong> Esta ferramenta usa a API do Claude (Anthropic). 
                Para funcionar, voc√™ precisa adicionar sua pr√≥pria chave de API.
            </p>
            <p>
                <strong>Como obter:</strong> Crie uma conta gratuita em 
                <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a> 
                e gere sua API key na se√ß√£o "API Keys". A Anthropic oferece cr√©ditos gratuitos para testar.
            </p>
            <p>
                <strong>Sua chave fica segura:</strong> A API key √© armazenada apenas no seu navegador (localStorage) 
                e nunca √© enviada para outros servidores al√©m da Anthropic.
            </p>
        </div>

        <div class="api-section">
            <h3>üîë Configurar API Key da Anthropic</h3>
            <div class="api-input-group">
                <input 
                    type="password" 
                    id="apiKey" 
                    placeholder="Cole sua API Key aqui (sk-ant-...)"
                />
                <button onclick="saveApiKey()">üíæ Salvar</button>
            </div>
            <div class="api-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">API Key n√£o configurada</span>
            </div>
        </div>

        <div class="info-box">
            <h3>üí° Como funciona esta ferramenta</h3>
            <ul>
                <li><strong>1.</strong> Configure sua API Key da Anthropic (necess√°rio apenas uma vez)</li>
                <li><strong>2.</strong> Descreva seu problema em detalhes</li>
                <li><strong>3.</strong> A IA Claude analisa e gera um plano 5W2H completo e estruturado</li>
                <li><strong>4.</strong> Baixe em PDF profissional para apresentar</li>
            </ul>
        </div>

        <div class="input-section">
            <label for="problem">üìù Descreva o problema ou situa√ß√£o:</label>
            <textarea 
                id="problem" 
                placeholder="Seja espec√≠fico! Exemplo: 'Nossa equipe de vendas n√£o est√° batendo as metas mensais. As vendas ca√≠ram 30% nos √∫ltimos 3 meses, a motiva√ß√£o est√° baixa e perdemos 2 clientes importantes. Precisamos reverter essa situa√ß√£o com urg√™ncia e recuperar a performance.'"
            ></textarea>
            
            <div class="example-problems">
                <h4>üí° Exemplos de problemas (clique para usar):</h4>
                <div class="example-item" onclick="useExample(0)">
                    <strong>Gest√£o de Vendas</strong>
                    <span>Queda de 30% nas vendas nos √∫ltimos 3 meses, equipe desmotivada</span>
                </div>
                <div class="example-item" onclick="useExample(1)">
                    <strong>Qualidade do Produto</strong>
                    <span>Aumento de 15% nas reclama√ß√µes de clientes sobre defeitos</span>
                </div>
                <div class="example-item" onclick="useExample(2)">
                    <strong>Processos Internos</strong>
                    <span>Tempo de entrega aumentou de 5 para 12 dias, clientes insatisfeitos</span>
                </div>
                <div class="example-item" onclick="useExample(3)">
                    <strong>Recursos Humanos</strong>
                    <span>Alta rotatividade de funcion√°rios (40% ao ano), custos com recrutamento</span>
                </div>
            </div>
        </div>

        <div class="button-group">
            <button class="generate-btn" onclick="generatePlan()" id="generateBtn">
                <span>‚ú®</span> Gerar Plano 5W2H com IA
            </button>
            <button class="download-btn" onclick="downloadPDF()" id="downloadBtn">
                <span>üì•</span> Baixar PDF
            </button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p class="loading-text">ü§ñ IA analisando seu problema e gerando o plano de a√ß√£o...</p>
            <p style="color: #999; margin-top: 10px; font-size: 0.9em;">Isso pode levar 5-10 segundos</p>
        </div>

        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <div class="result-section" id="resultSection">
            <h2>üìã Seu Plano de A√ß√£o 5W2H</h2>
            <table class="result-table" id="resultTable">
                <thead>
                    <tr>
                        <th>Dimens√£o 5W2H</th>
                        <th>Plano Gerado pela IA</th>
                    </tr>
                </thead>
                <tbody id="resultBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let currentPlan = null;
        const EXAMPLES = [
            "Nossa equipe de vendas n√£o est√° batendo as metas mensais. As vendas ca√≠ram 30% nos √∫ltimos 3 meses, a motiva√ß√£o est√° baixa e perdemos 2 clientes importantes para a concorr√™ncia. O time reclama de falta de treinamento e ferramentas inadequadas. Precisamos reverter essa situa√ß√£o urgentemente e recuperar a performance.",
            "Recebemos um aumento de 15% nas reclama√ß√µes de clientes sobre defeitos nos produtos. A taxa de devolu√ß√£o subiu de 2% para 5% no √∫ltimo trimestre. O controle de qualidade atual √© manual e n√£o detecta todos os problemas. Isso est√° prejudicando nossa reputa√ß√£o e aumentando custos.",
            "O tempo de entrega dos pedidos aumentou de 5 para 12 dias em m√©dia. Clientes est√£o cancelando pedidos e deixando avalia√ß√µes negativas. O processo atual √© desorganizado, com muitas etapas manuais e falta de rastreamento. Perdemos 20% dos clientes por atrasos.",
            "A empresa est√° enfrentando alta rotatividade de funcion√°rios, com 40% de turnover anual. Os custos com recrutamento e treinamento dobraram. Funcion√°rios relatam falta de plano de carreira, sal√°rios defasados e ambiente de trabalho estressante. Isso afeta a produtividade e o clima organizacional."
        ];

        // Check if API key exists on load
        window.addEventListener('DOMContentLoaded', function() {
            const savedKey = localStorage.getItem('anthropic_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
                updateApiStatus(true);
            }
        });

        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            
            if (!apiKey) {
                showError('Por favor, insira uma API Key v√°lida.');
                return;
            }

            if (!apiKey.startsWith('sk-ant-')) {
                showError('API Key inv√°lida. Deve come√ßar com "sk-ant-"');
                return;
            }

            localStorage.setItem('anthropic_api_key', apiKey);
            updateApiStatus(true);
            showSuccess('‚úÖ API Key salva com sucesso! Agora voc√™ pode gerar planos com IA.');
        }

        function updateApiStatus(connected) {
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            
            if (connected) {
                dot.classList.add('connected');
                text.textContent = 'API Key configurada ‚úì';
                text.style.color = '#10b981';
            } else {
                dot.classList.remove('connected');
                text.textContent = 'API Key n√£o configurada';
                text.style.color = '#dc3545';
            }
        }

        function useExample(index) {
            document.getElementById('problem').value = EXAMPLES[index];
        }

        async function generatePlan() {
            const apiKey = localStorage.getItem('anthropic_api_key');
            const problem = document.getElementById('problem').value.trim();
            
            if (!apiKey) {
                showError('‚ö†Ô∏è Configure sua API Key da Anthropic antes de gerar o plano.');
                return;
            }

            if (!problem) {
                showError('‚ö†Ô∏è Por favor, descreva o problema antes de gerar o plano.');
                return;
            }

            hideMessages();
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('downloadBtn').style.display = 'none';

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 2000,
                        messages: [{
                            role: 'user',
                            content: `Voc√™ √© um especialista em gest√£o, an√°lise de problemas e planejamento estrat√©gico. Analise o seguinte problema e crie um plano de a√ß√£o 5W2H detalhado, pr√°tico e acion√°vel.

Problema: ${problem}

Crie um plano de a√ß√£o 5W2H completo seguindo EXATAMENTE esta estrutura JSON. Seja espec√≠fico, detalhado e pr√°tico em cada dimens√£o:

{
  "what": "Descri√ß√£o clara e espec√≠fica do que ser√° feito - a a√ß√£o principal",
  "why": "Justificativa detalhada do por que isso √© importante e qual o impacto esperado",
  "where": "Local, departamento, contexto ou ambiente onde ser√° executado",
  "when": "Prazo espec√≠fico ou cronograma realista de execu√ß√£o",
  "who": "Respons√°veis espec√≠ficos pela execu√ß√£o (cargos/fun√ß√µes)",
  "how": "Metodologia detalhada: passo a passo de como ser√° executado",
  "howMuch": "Estimativa realista de custos, recursos financeiros e investimentos necess√°rios"
}

IMPORTANTE: 
- Seja espec√≠fico e detalhado em cada campo
- Use dados quantitativos quando poss√≠vel
- Torne o plano pr√°tico e acion√°vel
- Responda APENAS com o JSON v√°lido, sem markdown, sem explica√ß√µes adicionais`
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Erro ao gerar o plano');
                }

                const data = await response.json();
                let content = data.content[0].text.trim();
                
                // Remove markdown code blocks if present
                if (content.includes('```')) {
                    content = content.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                }
                
                currentPlan = JSON.parse(content);
                displayPlan(currentPlan, problem);
                showSuccess('‚úÖ Plano gerado com sucesso! Revise e baixe o PDF quando estiver pronto.');
                
            } catch (error) {
                console.error('Error:', error);
                if (error.message.includes('authentication') || error.message.includes('api_key')) {
                    showError('‚ùå Erro de autentica√ß√£o. Verifique se sua API Key est√° correta.');
                } else {
                    showError('‚ùå Erro ao gerar o plano: ' + error.message);
                }
            } finally {
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displayPlan(plan, problem) {
            const dimensions = [
                { key: 'what', label: 'What (O qu√™)', icon: 'üéØ', desc: 'O que ser√° feito' },
                { key: 'why', label: 'Why (Por qu√™)', icon: '‚ùì', desc: 'Por que fazer' },
                { key: 'where', label: 'Where (Onde)', icon: 'üìç', desc: 'Onde ser√° executado' },
                { key: 'when', label: 'When (Quando)', icon: 'üìÖ', desc: 'Prazo de execu√ß√£o' },
                { key: 'who', label: 'Who (Quem)', icon: 'üë§', desc: 'Respons√°veis' },
                { key: 'how', label: 'How (Como)', icon: '‚öôÔ∏è', desc: 'Como ser√° feito' },
                { key: 'howMuch', label: 'How Much (Quanto)', icon: 'üí∞', desc: 'Custos estimados' }
            ];

            const tbody = document.getElementById('resultBody');
            tbody.innerHTML = '';

            dimensions.forEach(dim => {
                const row = tbody.insertRow();
                const cellDimension = row.insertCell(0);
                const cellDescription = row.insertCell(1);

                cellDimension.className = 'dimension';
                cellDimension.innerHTML = `${dim.icon} ${dim.label}`;
                cellDescription.textContent = plan[dim.key] || 'N√£o especificado';
            });

            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('downloadBtn').style.display = 'flex';
            
            // Scroll to results
            setTimeout(() => {
                document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function downloadPDF() {
            if (!currentPlan) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Header
            doc.setFontSize(22);
            doc.setTextColor(102, 126, 234);
            doc.text('Plano de A√ß√£o 5W2H', 105, 20, { align: 'center' });

            doc.setFontSize(9);
            doc.setTextColor(150);
            doc.text('Gerado por IA (Claude)', 105, 27, { align: 'center' });

            doc.setFontSize(10);
            doc.setTextColor(100);
            const date = new Date().toLocaleDateString('pt-BR', { 
                day: '2-digit', 
                month: 'long', 
                year: 'numeric' 
            });
            doc.text(`Data: ${date}`, 105, 33, { align: 'center' });

            // Problem description
            const problem = document.getElementById('problem').value;
            doc.setFontSize(11);
            doc.setTextColor(0);
            doc.setFont(undefined, 'bold');
            doc.text('Problema/Situa√ß√£o Analisada:', 20, 43);
            
            doc.setFont(undefined, 'normal');
            doc.setFontSize(10);
            doc.setTextColor(60);
            const splitProblem = doc.splitTextToSize(problem, 170);
            doc.text(splitProblem, 20, 50);

            const problemHeight = splitProblem.length * 5;

            // 5W2H Table
            const tableData = [
                ['üéØ What (O qu√™)', currentPlan.what],
                ['‚ùì Why (Por qu√™)', currentPlan.why],
                ['üìç Where (Onde)', currentPlan.where],
                ['üìÖ When (Quando)', currentPlan.when],
                ['üë§ Who (Quem)', currentPlan.who],
                ['‚öôÔ∏è How (Como)', currentPlan.how],
                ['üí∞ How Much (Quanto)', currentPlan.howMuch]
            ];

            doc.autoTable({
                startY: 50 + problemHeight + 10,
                head: [['Dimens√£o 5W2H', 'Descri√ß√£o do Plano']],
                body: tableData,
                theme: 'striped',
                headStyles: {
                    fillColor: [102, 126, 234],
                    fontSize: 11,
                    fontStyle: 'bold',
                    halign: 'left'
                },
                bodyStyles: {
                    fontSize: 9,
                    cellPadding: 8
                },
                columnStyles: {
                    0: { 
                        cellWidth: 45, 
                        fontStyle: 'bold', 
                        fillColor: [248, 249, 255] 
                    },
                    1: { cellWidth: 135 }
                },
                margin: { left: 15, right: 15 }
            });

            // Footer
            const pageCount = doc.internal.getNumberOfPages();
            doc.setFontSize(8);
            doc.setTextColor(150);
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.text(
                    'Gerado pelo Gerador 5W2H com IA | Powered by Claude (Anthropic)',
                    105,
                    doc.internal.pageSize.height - 10,
                    { align: 'center' }
                );
            }

            const filename = `Plano-5W2H-${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(filename);
            
            showSuccess('‚úÖ PDF baixado com sucesso!');
        }

        function showError(message) {
            hideMessages();
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 8000);
        }

        function showSuccess(message) {
            hideMessages();
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 6000);
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }
    </script>
</body>
</html>